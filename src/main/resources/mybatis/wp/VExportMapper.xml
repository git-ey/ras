<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="VExportMapper">

    <select id="selectV300Data" parameterType="java.util.Map" resultType="java.util.Map"> 
        SELECT
		    V300.TYPE as type,
		    V300.INT_RISK_PERIOD as intRiskPeriod,
		    IF(V300.AMOUNT = 0, null, V300.AMOUNT) as amount,
		    IF(V300.AMOUNT_LAST_CNY = 0, null, V300.AMOUNT_LAST_CNY) as amountLast,
		    V300.SORT as sort
		FROM
		    wp_v300 V300 
		WHERE
		    1 = 1 
		AND V300.STATUS = 'Y'
		AND V300.FUND_ID = #{fundId}
		AND V300.PERIOD = #{period}
    </select>
    
    <select id="selectV300IntRiskPeriodData" parameterType="java.util.Map" resultType="java.lang.String"> 
        SELECT DISTINCT
            V300.INT_RISK_PERIOD as intRiskPeriod
        FROM
            wp_v300 V300 
        WHERE
            1 = 1 
        AND V300.STATUS = 'Y'
        AND V300.FUND_ID = #{fundId}
        AND V300.PERIOD = #{period}
        ORDER BY
            V300.SORT
    </select>
    
    <select id="selectV400FundInfoData" parameterType="java.util.Map" resultType="java.util.Map">
        SELECT
	        IFNULL(sfi.INT_SEN_METHOD,'久期法') as intSenMethod,
	        IFNULL(sfi.PRI_SEN_METHOD,'Beta法') as priSenMethod
		FROM
		    sys_fund_info sfi 
		WHERE
		    1 = 1
		AND sfi.FUND_ID = #{fundId}
		AND sfi.ACTIVE = 'Y'
		LIMIT 1
    </select>
    
    <select id="selectV400HypothesisData" parameterType="java.util.Map" resultType="java.lang.String">
        SELECT
		    CONCAT( sh.HYPOTHESIS_NUM, '. ', sh.DESCRIPTION ) AS description 
		FROM
		    sys_hypothesis sh 
		WHERE
		    1 = 1 
	    AND sh.FUND_ID = #{fundId}
	    AND sh.ACTIVE = 'Y' 
	    AND sh.HYPOTHESIS_TPYE = '利率'
		ORDER BY sh.HYPOTHESIS_NUM
    </select>
    
    <select id="selectV400HypothesisDataForReport" parameterType="java.util.Map" resultType="java.util.Map">
        SELECT
            sh.HYPOTHESIS_NUM as hypothesisNum,
            sh.DESCRIPTION AS description 
        FROM
            sys_hypothesis sh 
        WHERE
            1 = 1 
        AND sh.FUND_ID = #{fundId}
        AND sh.ACTIVE = 'Y' 
        AND sh.HYPOTHESIS_TPYE = '利率'
        ORDER BY sh.HYPOTHESIS_NUM
    </select>
    
    <select id="selectV400LineData" parameterType="java.util.Map" resultType="java.util.Map"> 
	    SELECT
		    V400L.TRX_CODE as trxCode,
		    V400L.SHORT_NAME as shortName,
		    V400L.MKT_VALUE as mktValue,
		    V400L.CAL_RESULT as calResult
		FROM wp_v400_line V400L
		WHERE
		     1 = 1
		AND V400L.`STATUS` = 'Y'
		AND V400L.FUND_ID = #{fundId}
		AND V400L.PERIOD = #{period}
    </select>
    
    <select id="selectV400TestData" parameterType="java.util.Map" resultType="java.util.Map">
        SELECT
		    V400T.SORT as sort,
		    V400T.VAR_DESC as varDesc,
		    IF(V400T.INFL_LAST = 0, null, V400T.INFL_LAST) as inflLast,
		    IF(V400T.TOTAL_MKT_VALUE = 0, null, V400T.TOTAL_MKT_VALUE) as totalMktValue,
		    IF(V400T.SEN_ASSET_EXCL = 0, null, V400T.SEN_ASSET_EXCL) as senAssetExcl,
		    IF(V400T.VAR_FLEX = 0, null, V400T.VAR_FLEX) as varFlex,
		    IF(V400T.INFL_CURRENT_CLIENT = 0, null, V400T.INFL_CURRENT_CLIENT) as inflCurrentClient
		FROM
		    wp_v400_test V400T
		WHERE
		    1 = 1
		AND V400T.STATUS = 'Y'
		AND V400T.FUND_ID = #{fundId}
		AND V400T.PERIOD = #{period}
		ORDER BY V400T.SORT
		LIMIT 0,2 
    </select>
    
    <select id="selectV500InvestData" parameterType="java.util.Map" resultType="java.util.Map"> 
        SELECT
		    V500IV.ITEM as item,
		    V500IV.MKT_VALUE as mktValue,
		    V500IV.PRI_SEN_ASSET as priSenAsset
		FROM
		    wp_v500_invest_view V500IV
		WHERE
		    1 = 1
		AND V500IV.FUND_ID = #{fundId}
		AND V500IV.PERIOD = #{period}
		ORDER BY
		    V500IV.SORT    
    </select>
    
    <select id="selectV500riskExposureData" parameterType="java.util.Map" resultType="java.util.Map"> 
        SELECT
		    V500REV.ITEM as item,
		    IF(V500REV.AMOUNT_CURRENT = 0, null,  V500REV.AMOUNT_CURRENT) as amountCurrent,
		    IF(V500REV.AMOUNT_LAST = 0, null,  V500REV.AMOUNT_LAST) as amountLast,
		    IF(V500REV.NET_VALUE_CURRENT = 0, null, V500REV.NET_VALUE_CURRENT) as netValueCurrent,
		    IF(V500REV.RATIO_LAST = 0, null,  V500REV.RATIO_LAST) as ratioLast,
		    IF(V500REV.RATIO_CURRENT = 0, null,  V500REV.RATIO_CURRENT) as ratioCurrent
		FROM
		    wp_v500_risk_exposure_view V500REV
		WHERE
	        1 = 1
		AND V500REV.STATUS = 'Y'
        AND V500REV.FUND_ID = #{fundId}
        AND V500REV.PERIOD = #{period}
    </select>
    
    <select id="selectV500riskExposureSumData" parameterType="java.util.Map" resultType="java.util.Map">
        SELECT
            IF(SUM(V500REV.NET_VALUE_CURRENT) = 0, null, SUM(V500REV.NET_VALUE_CURRENT)) as netValue,
            IF(SUM(V500REV.AMOUNT_CURRENT) = 0, null, SUM(V500REV.AMOUNT_CURRENT)) as amountCurrent,
            IF(SUM(V500REV.AMOUNT_LAST) = 0, null, SUM(V500REV.AMOUNT_LAST)) as amountLast,
            IF(SUM(V500REV.RATIO_LAST) = 0, null, SUM(V500REV.RATIO_LAST)) as ratioLast,
            IF(SUM(V500REV.RATIO_CURRENT) = 0, null, SUM(V500REV.RATIO_CURRENT)) as ratioCurrent
        FROM
            wp_v500_risk_exposure_view V500REV
        where
            1 = 1
        and V500REV.STATUS = 'Y'
        and V500REV.FUND_ID = #{fundId}
        and V500REV.PERIOD = #{period}
        and V500REV.ITEM != '交易性金融资产-基金投资'
        LIMIT 1
    </select>

    <select id="selectV500HypothesisData" parameterType="java.util.Map" resultType="java.lang.String">
        SELECT
            CONCAT( sh.HYPOTHESIS_NUM, '. ', sh.DESCRIPTION ) AS description 
        FROM
            sys_hypothesis sh 
        WHERE
            1 = 1 
        AND sh.FUND_ID = #{fundId}
        AND sh.ACTIVE = 'Y' 
        AND sh.HYPOTHESIS_TPYE = '其他价格'
        ORDER BY sh.HYPOTHESIS_NUM
    </select>
    
    <select id="selectV500HypothesisDataForReport" parameterType="java.util.Map" resultType="java.util.Map">
       SELECT
            sh.HYPOTHESIS_NUM as hypothesisNum,
            sh.DESCRIPTION AS description 
        FROM
            sys_hypothesis sh 
        WHERE
            1 = 1 
        AND sh.FUND_ID = #{fundId}
        AND sh.ACTIVE = 'Y' 
        AND sh.HYPOTHESIS_TPYE = '其他价格'
        ORDER BY sh.HYPOTHESIS_NUM
    </select>
    
    <select id="selectV500TestData" parameterType="java.util.Map" resultType="java.util.Map">
        SELECT
	        V500T.SORT as sort,
	        V500T.VAR_DESC as varDesc,
	        IF(V500T.INFL_LAST = 0, null, V500T.INFL_LAST) as inflLast,
	        IF(V500T.VAR_FLEX = 0, null, V500T.VAR_FLEX) as varFlex,
	        IF(V500T.INFL_CURRENT_CLIENT = 0, null, V500T.INFL_CURRENT_CLIENT) as inflCurrentClient
		FROM
	        wp_v500_test V500T
		WHERE
	        1 = 1
		AND V500T.STATUS = 'Y'
		AND V500T.FUND_ID = #{fundId}
		AND V500T.PERIOD = #{period}
		ORDER BY V500T.SORT
		LIMIT 0,2
    </select>
    
    <select id="selectV500DetailSlopeData" parameterType="java.util.Map" resultType="java.util.Map"> 
        SELECT
            DATE_FORMAT(V500LS.TRX_DATE,'%Y-%m-%d') AS trxDate,
            V500LS.UNIT_NET_VALUE AS unitNetValue,
            V500LS.DIVIDEND AS dividend,
            V500LS.CAL_RESULT AS calResult
        FROM
            wp_v500_line_slope V500LS
        WHERE
            1 = 1
        AND V500LS.`STATUS` = 'Y'
        AND V500LS.FUND_ID = #{fundId}
        AND V500LS.PERIOD = #{period}
        ORDER BY V500LS.SEQ
    </select>
    
    <select id="selectV500DetailBetaData" parameterType="java.util.Map" resultType="java.util.Map"> 
        SELECT
		    V500L.TRX_CODE AS trxCode,
		    V500L.SHORT_NAME AS shortName,
		    V500L.MKT_VALUE AS mktValue,
		    V500L.CAL_RESULT AS calResult
		FROM
		    wp_v500_line V500L
		WHERE
		    1 = 1
		AND V500L.`STATUS` = 'Y'
		AND V500L.FUND_ID = #{fundId}
		AND V500L.PERIOD = #{period}
    </select>
    
</mapper>